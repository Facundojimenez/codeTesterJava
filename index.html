<html>
  <head>
		<!-- Bootstrap y estilos -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="/path/to/styles/default.min.css">
    
		<!-- Libreria para el editor de codigo cusotm -->
    <script src="codemirror-5.65.9/lib/codemirror.js"></script>
    <script src="codemirror-5.65.9/mode/clike/clike.js"></script>
    <link rel="stylesheet" href="codemirror-5.65.9/lib/codemirror.css">
    <link rel="stylesheet" href="codemirror-5.65.9/theme/monokai.css">
    
	</head>	
	<body>
		<div class="container-fluid mainContainer">
			<div class="card p-3 container">
				<h1 class="text-center"> Herramienta de gestión de testing </h1>
				<form class="form-group">
					<label for="exampleFormControlTextarea1">Copie y pegue el metodo</label>
					<textarea id="codigo" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
					<button id="ejecutar" type="button" class="btn btn-primary mt-2" onclick="mostrarMetricas()">Analizar
						Código</button>
				</form>
				<div class="row">
					<div class="col-3">
						<label>Lineas Totales</label>
					</div>
					<div class="col-3">
						<input class="tab" id="lineastotales" disabled="" />
					</div>
					<div class="col-3">
						<label>Lineas de Codigo</label>
					</div>
					<div class="col-3">
						<input class="tab" id="lineascodigo" disabled="" />
					</div>
					<div class="col-3">
						<label>Lineas de Codigo Comentadas</label>
					</div>
					<div class="col-3">
						<input class="tab" id="lineascomentadas" disabled="" />
					</div>
					<div class="col-3">
						<label>Porcentaje Lineas Comentadas</label>
					</div>
					<div class="col-3">
						<input class="tab" id="lineasporcentaje" disabled="" />
					</div>
					<div class="col-3">
						<label>Complejidad Ciclomatica</label>
					</div>
					<div class="col-3">
						<input class="tab" id="complejidad" disabled="" />
					</div>
					<div class="col-3">
						<label>Halstead Longitud</label>
					</div>
					<div class="col-3">
						<input class="tab" id="longitud" disabled="" />
					</div>
					<div class="col-3">
						<label>Halstead Volumen</label>
					</div>
					<div class="col-3">
						<input class="tab" id="volumen" disabled="" />
					</div>
					<div class="col-3">
						<label>Operadores Halstead</label>
					</div>
					<div class="col-">
						<textarea rows="5" cols="25" class="tab" id="operadores"></textarea>
					</div>
				</div>
			</div>
    </div>

		<!-- Script de la logica del analisis del codigo -->
		<script>
			/* Consideraciones:
					Las lineas de codigo totales OK.
					Las lineas de codigo comentadas, cuentan solo comentarios simples.
					Complejidad ciclomatica, cuenta la cantidad de IF, ELSE, FOR, WHILE, && y || que aparecen en el codigo.
					Los operadores se pueden agregar o eliminar a gusto.
					Para Halstead Longitud y Volumen ver: https://en.wikipedia.org/wiki/Halstead_complexity_measures
			*/

			document.getElementById("operadores").value =
				"+, -, /, *, int, double, float, ;, :, public, static, void, &&, ||, <=, >=, <, >";

			///-------------Inicializacion del editor--------
			var editor = CodeMirror.fromTextArea(document.getElementById("codigo"), {
				lineNumbers: true,
				matchBrackets: true,
				mode: "text/x-java",
				theme: "monokai"
			});
			// ------------------------------------------

			function mostrarMetricas() {
				if (document.getElementById("operadores").value.length == 0) {
					alert("Los operadores no pueden quedar vacios");
					return;
				}
				
				// var codigoRaw = document.getElementById("codigo").value;         
				var codigoRaw = editor.getValue(); // Esto lo cambié yo para que funcione con la libreria de código - F
				if (codigoRaw.length == 0) {
					alert("Ingrese un codigo por favor");
					return;
				}

				codigoRaw = codigoRaw.toLowerCase();
				var lineas_del_archivo = codigoRaw.split("\n").length - 1;
				var lineas_comentarios_simples = codigoRaw.split("//").length - 1;
				var lineas_de_codigo = parseInt(
					lineas_del_archivo - lineas_comentarios_simples
				);
				var porcentaje_lineas_comentadas =
					parseFloat(
						(parseInt(lineas_comentarios_simples) /
							parseInt(lineas_del_archivo)) *
							100
					).toFixed(2) + "%";
				if (!isNaN(porcentaje_lineas_comentadas))
					porcentaje_lineas_comentadas = 0 + "%";
				var complejidad_ciclomatica = complejidadCiclomatica(codigoRaw);
				var halstead = halsteadMetodo(codigoRaw);
				var longitudHalstead = halstead[0];
				var volumenHalstead = halstead[1];

				document.getElementById("lineastotales").value =
					lineas_del_archivo + 1;
				document.getElementById("lineascodigo").value = lineas_de_codigo + 1;
				document.getElementById("lineascomentadas").value =
					lineas_comentarios_simples + 1;
				document.getElementById("lineasporcentaje").value =
					porcentaje_lineas_comentadas;
				document.getElementById("complejidad").value =
					complejidad_ciclomatica;
				document.getElementById("longitud").value = longitudHalstead;
				document.getElementById("volumen").value = volumenHalstead;
				
				///esto me parece malardo
				// if (complejidad_ciclomatica < 11)
				//   alert("No es necesario modularizar el codigo");
				// else
				//  alert("Se recomienda modularizar el programa");
			}

			function complejidadCiclomatica(texto) {
				var c = 0;
				c += texto.split("if").length - 1;
				c += texto.split("else").length - 1;
				c += texto.split("for").length - 1;
				c += texto.split("while").length - 1;
				c += texto.split("||").length - 1;
				c += texto.split("&&").length - 1;
				return c + 1;
			}

			function halsteadMetodo(texto) {
				//Operadores + - = * ; int double float return
				var textosSinComentarios = texto.replace(
					/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,
					""
				);
				var cantidadOperadoresTotales = 0;
				var cantidadOperandosTotales = 0;
				var cantidadOperadoresUnicos = 0;
				var cantidadOperandosUnicos = 0;
				var operadores = ["+", "-", "/", "*", "int", "double", "float", ";", ":", "public", "static", "void", "&&", "||", "<=", ">=", "<", ">"];
				var operadores = document
					.getElementById("operadores")
					.value.split(",");
				var operandosUnicos = [];
				var i;
				//OPERADORES UNICOS Y TOTALES.
				for (i = 0; i < operadores.length; i++) {
					if (textosSinComentarios.indexOf(operadores[i]) != -1)
						cantidadOperadoresUnicos++;
					cantidadOperadoresTotales += texto.split(operadores[i]).length - 1;
				}

				//OPERADORES TOTALES

				//OPERANDOS UNICOS Y TOTALES.
				var aAnalizar = textosSinComentarios.split(" ");
				var hasta = textosSinComentarios.split(" ").length;
				for (j = 0; j < hasta; j++) {
					//Si no es un operador y todavia no esta en el array de operandos unicos.
					if (
						operadores.indexOf(aAnalizar[j]) == -1 &&
						operandosUnicos.indexOf(aAnalizar[j]) == -1
					) {
						operandosUnicos.push(aAnalizar[j]);
						cantidadOperandosUnicos++;
					}
					//Si no es un operador.
					if (operadores.indexOf(aAnalizar[j]) == -1)
						cantidadOperandosTotales++;
				}
				var longitudHalstead = parseInt(
					cantidadOperadoresUnicos * Math.log2(cantidadOperadoresUnicos) +
						cantidadOperandosUnicos * Math.log2(cantidadOperandosUnicos)
				);
				var volumenHalstead = parseFloat(
					(cantidadOperadoresTotales + cantidadOperandosTotales) *
						Math.log2(cantidadOperadoresUnicos + cantidadOperandosUnicos)
				).toFixed(2);
				return [longitudHalstead, volumenHalstead];
			}
		</script>


		<!-- Libreria bootstrap -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
  </body>
</html>
